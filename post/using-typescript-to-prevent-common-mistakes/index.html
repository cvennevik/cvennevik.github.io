<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Using TypeScript to prevent common mistakes - Cecilie Vennevik</title>
<meta name=author content="Cecilie Vennevik"><link rel=alternate href=https://www.cvennevik.no/index.xml type=application/rss+xml title="Cecilie Vennevik"><link rel=stylesheet href=https://www.cvennevik.no/css/bootstrap.min.css><link rel=stylesheet href=https://www.cvennevik.no/css/main.css><link rel=stylesheet href=https://www.cvennevik.no/css/fonts.css></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom top-nav-short"><div class=container-fluid><div class=navbar-header><a class=navbar-brand href=https://www.cvennevik.no/>Cecilie Vennevik</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"></ul></div></div></nav><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Using TypeScript to prevent common mistakes</h1><span class=post-meta>January 17, 2023</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>I have been struggling to write an article about type systems for about a week now. The ideas and angles I want to take kept changing between each writing session, preventing me from ever completing a single coherent article.</p><p>After venting about this on Mastodon, another user asked me what I thought about static types. They were mostly experienced with dynamically typed languages, and prefer the flexibility they offer.</p><p>It turns out this question was all I needed to focus and get my writing back on track - you may take this blog post as my longform answer.</p><p>In short: I think static types are a useful tool to prevent us from making very common mistakes. Like, really common. Like &ldquo;half of the bugs I investigate in JavaScript applications are caused by this&rdquo; common.</p><p>Here&rsquo;s a few examples to illustrate the types of mistakes I&rsquo;m talking about, and how adding static types with TypeScript helps prevent them.</p><h2 id=mistake-1-accessing-undefined-property-names>Mistake #1: Accessing undefined property names</h2><p>Say we are working with an object containing user profile data, and we want to send an email to that user. To do this, we access the user&rsquo;s email address via <code>user.emailAddress</code> and pass it to <code>sendEmail</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sendEmailToUser</span> (<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sendEmail</span>(<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>emailAddress</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But what if we are mistaken? What if the <code>user</code> object&rsquo;s property is actually named <code>emailaddress</code>, or <code>address</code>, or <code>username</code>, or - gasp - it does not actually have a property for email address at all? Well, then this code will instead attempt to send an email to <code>undefined</code>. That&rsquo;s no good.</p><p>To check for this potential issue, let us say we found the <code>UserProfile</code> type that describes the user data we expect, and specify that <code>user</code> is of type <code>UserProfile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>UserProfile</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>contactInfo</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>emailAddress</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sendEmailToUser</span> (<span style=color:#a6e22e>user</span>: <span style=color:#66d9ef>UserProfile</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sendEmail</span>(<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>emailAddress</span>); <span style=color:#75715e>// Causes a build error!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Oops! It turns out the <code>user.emailAddress</code> property does not exist. Now, because we are trying to access a property that does not exist on <code>UserProfile</code>, the TypeScript compiler produces an error.</p><p>The <code>UserProfile</code> type instead tells us that a <code>user.contactInfo.emailAddress</code> property exists. This is likely what we actually wanted to use, and replacing <code>user.emailAddress</code> with this will make the error go away.</p><h2 id=mistake-2-passing-invalid-data>Mistake #2: Passing invalid data</h2><p>Say we are working with a map, and want to place an icon at the spot where the user&rsquo;s mouse pointer is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getMousePosition</span> () {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setIconPosition</span> (<span style=color:#a6e22e>position</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>placeIconAtMousePosition</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMousePosition</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setIconPosition</span>(<span style=color:#a6e22e>mousePosition</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>What can go wrong here? Well, we do not know the structure of the data <code>getMousePosition</code> returns, nor what <code>setIconPosition</code> accepts. Even if we already know we are working with longitude and latitude positions in the same coordinate system, the position could be represented as a <code>{ lon, lat }</code> object, or an <code>{ x, y }</code> object, or a <code>[lon, lat]</code> array (or even a <code>[lat, lon]</code> array!).</p><p>Without type annotations, this code looks perfectly valid, even if the data structures may be incompatible. Now, if we add the correct types to the functions using TypeScript, the incompatibility comes to light:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getMousePosition</span> ()<span style=color:#f92672>:</span> { <span style=color:#a6e22e>lon</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>lat</span>: <span style=color:#66d9ef>number</span> } {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setIconPosition</span> (<span style=color:#a6e22e>position</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>x</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>y</span>: <span style=color:#66d9ef>number</span> }) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>placeIconAtMousePosition</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMousePosition</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setIconPosition</span>(<span style=color:#a6e22e>mousePosition</span>); <span style=color:#75715e>// Causes a build error!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>With the function types specified, TypeScript reports that we made a mistake passing <code>mousePosition</code> directly into <code>setIconPosition</code>. Instead, we should convert the <code>{ lon, lat }</code> object to an <code>{ x, y }</code> object.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>placeIconAtMousePosition</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMousePosition</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setIconPosition</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>x</span>: <span style=color:#66d9ef>mousePosition.lon</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>y</span>: <span style=color:#66d9ef>mousePosition.lat</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=mistake-3-not-handling-undefined-values>Mistake #3: Not handling undefined values</h2><p>The third common mistake TypeScript can prevent is the famed <em>&ldquo;billion dollar mistake&rdquo;</em>: <del>null</del> undefined values!</p><p>Let&rsquo;s reuse the map position code example and see what happens when we modify it. Say we change the implementation of <code>getMousePosition</code> so it returns <code>undefined</code> when the mouse is outside the map. TypeScript will not permit this since this does not match the return type of <code>getMousePosition</code>, so we change the return type so it can also be <code>undefined</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getMousePosition</span> ()<span style=color:#f92672>:</span> { <span style=color:#a6e22e>lon</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>lat</span>: <span style=color:#66d9ef>number</span> } <span style=color:#f92672>|</span> <span style=color:#66d9ef>undefined</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setIconPosition</span> (<span style=color:#a6e22e>position</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>placeIconAtMousePosition</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMousePosition</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setIconPosition</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>x</span>: <span style=color:#66d9ef>mousePosition.lon</span>, <span style=color:#75715e>// Causes a build error!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>y</span>: <span style=color:#66d9ef>mousePosition.lat</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Oh no! This change actually breaks <code>placeIconAtMousePosition</code>, because it was written with the assumption that <code>getMousePosition</code> always returns a valid position. When it instead returns <code>undefined</code>, the code will throw a runtime error when trying to access <code>mousePosition.lon</code>.</p><p>If we were working with untyped JavaScript, this mistake may have managed to sneak in. Luckily, TypeScript caught this error for us. It refuses to compile until we have correctly handled the case where <code>mousePosition</code> is undefined. If we add a check for it, the error disappears:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>placeIconAtMousePosition() {</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getMousePosition</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>mousePosition</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setIconPosition</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>x</span>: <span style=color:#66d9ef>mousePosition.lon</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>y</span>: <span style=color:#66d9ef>mousePosition.lat</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I like to set up development environments so it is easy to write correct code and hard to write incorrect code. Static types are only one of several tools I use for this, but they are one of my favorites. They tell us what we can and cannot do with our data, and they are effective for catching very common mistakes. Because of this, I find the overhead of opting into static typing with TypeScript well worth it.</p></article></div></div></div><footer><div class=footer-links><a rel=me href=https://hachyderm.io/@cvennevik title=Mastodon>Mastodon</a>
<a href=https://twitter.com/cvennevik title=Twitter>Twitter (unused)</a>
<a href=/index.xml title=RSS>RSS</a></div><p class=theme-by>Theme based on <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a>, adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></footer></body></html>