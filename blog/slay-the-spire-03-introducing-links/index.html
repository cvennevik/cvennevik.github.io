<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="color-scheme" content="dark light">
        <title>Slay the Spire #3: Introducing links - Cecilie Vennevik</title>
        <link rel="icon" type="image/jpg" href="/img/logo-32px.jpg" sizes="32x32">
        <link rel="icon" type="image/jpg" href="/img/logo-48px.jpg" sizes="48x48">
        <link rel="icon" type="image/jpg" href="/img/logo-64px.jpg" sizes="64x64">
        <meta name="author" content="Cecilie Vennevik">
        <link rel="alternate" title="Cecilie Vennevik's blog" href="/blog/rss.xml" type="application/rss+xml">
        <link rel="alternate" title="Cecilie Vennevik's blog" href="/blog/atom.xml" type="application/atom+xml">
        <style>
            *,
*::after,
*::before {
	box-sizing: border-box;
}

:root {
	--codeblock-color: #eee;
	--codeblock-background-color: #2b2b2b;
	--home-link-focus-color: #89cff0;

	--background-color: #f0f9fd;
	--foreground-color: rgba(255, 255, 255, 30%);
	--border-color: rgba(0, 0, 0, 10%);
	--text-color: #212;
	--code-background-color: rgba(0, 0, 0, 10%);
	--link-color: #086391;
	--link-focus-color: #89cff0;
	--header-background-color: #89cff0;
	--header-background-border-color: #086391;
	--header-link-color: #086391;
	--header-link-focus-color: #f0f9fd;
}

@media (prefers-color-scheme: dark) {
	:root {
		--background-color: #222;
		--foreground-color: #444;
		--border-color: rgba(255, 255, 255, 10%);
		--text-color: #fff;
		--code-background-color: #444;
		--link-color: #89cff0;
		--link-focus-color: #b8e2f6;
		--header-background-color: #086391;
		--header-background-border-color: #034c70;
		--header-link-color: #89cff0;
		--header-link-focus-color: #f0f9fd;
	}
}

html {
	background-color: var(--background-color);
	color: var(--text-color);
	font-family: 'Helvetica Neue', 'Arial Nova', Helvetica, Arial, sans-serif;
	height: 100%;
	line-height: 1.5;
}

body {
	margin: 0;
	padding: 0;
}

body > header {
	--link-color: var(--header-link-color);
	--link-focus-color: var(--header-link-focus-color);
	background-color: var(--header-background-color);
	border-bottom: .25rem solid var(--header-background-border-color);
}

.navbar {
	align-items: center;
	box-sizing: content-box;
	display: flex;
	gap: 1rem;
	margin: auto;
	max-width: 50rem;
	min-height: 3rem;
	padding: .5rem 1rem;
}

.navbar img {
	border-radius: 100%;
	display: inline-block;
	height: 2rem;
	width: 2rem;
}

.navbar nav {
	flex-grow: 1;
}

.crumbs {
	align-items: center;
	display: flex;
	gap: .5rem;
	list-style: none;
	margin: 0;
	padding: 0;
}

.crumbs li {
	display: flex;
	gap: .5rem;
}

main {
	margin: 0 auto;
	max-width: 50rem;
	padding: 1rem;
}

h1 { font-size: 2.5rem; }
h2 { font-size: 2rem; }
h3 { font-size: 1.75rem; }
h4 { font-size: 1.5rem; }
h5 { font-size: 1.3rem; }
h6 { font-size: 1.2rem; }

h1, h2, h3, h4, h5, h6 {
	font-weight: bold;
	line-height: 1.1;
	margin-block-start: 1em;
	margin-block-end: 0;
}

h1 {
	margin-block-start: 0;
}

a {
	color: var(--link-color);
	transition: color .1s;
}

a:focus,
a:hover {
	color: var(--link-focus-color);
}

blockquote {
	border-left: .3rem solid var(--border-color);
	margin: 1rem 0;
	padding: 0 1rem;
}

:not(pre) > code {
	background-color: var(--code-background-color);
}

pre {
	background-color: var(--codeblock-background-color);
	border-radius: 0.5em;
	color: var(--codeblock-color);
	font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace;
	hyphens: none;
	line-height: 1.4;
	padding: 1em;
	overflow: auto;
	tab-size: 4;
	white-space: pre-wrap;
}

img {
	max-width: 100%;
}

figure {
	display: flex;
	flex-direction: column;
	justify-content: center;
	margin: 1.3rem 0;
}

figure img {
	border: .3rem solid var(--border-color);
	border-radius: .3rem;
}

figcaption {
	font-style: italic;
	margin-top: .5em;
	text-align: center;
}

        </style>
        <script>
            // <input-persist> observes all contained input elements with a [data-persist-key] attribute.
// When the user changes the value of an input element, it saves that value to local storage.
// The [data-persist-key] attribute specifies the storage key.
// When an input element first loads - or is placed - inside <input-parsist>, its value is set to the stored value.
//
// <input-persist> supports the following elements:
// - <input type="checkbox">
// - <input type="radio">
customElements.define(
  "input-persist",
  class extends HTMLElement {
    connectedCallback() {
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          mutation.removedNodes.forEach((node) => {
            node.removeEventListener("input", this);
          });
          mutation.addedNodes.forEach((node) => {
            if (node.nodeName == "INPUT") {
              node.addEventListener("input", this);
              const persistKey = node.dataset.persistKey;
              if (!persistKey) return;

              const savedValue = localStorage.getItem(persistKey);
              if (savedValue) {
                switch (node.type) {
                  case "checkbox":
                  case "radio":
                    node.checked = savedValue === "checked";
                    break;
                  default:
                    console.warn(
                      `input-persist: cannot persist unsupported element <input type=${node.type}>.`,
                      node
                    );
                    break;
                }
              }
            }
          });
        });
      });
      observer.observe(this, { childList: true, subtree: true });
    }

    handleEvent(event) {
      const persistKey = event.target.dataset.persistKey;
      if (!persistKey) return;

      switch (event.target.type) {
        case "checkbox":
          localStorage.setItem(
            persistKey,
            event.target.checked ? "checked" : "unchecked"
          );
          break;
        case "radio":
          const radioName = event.target.getAttribute("name");
          this.querySelectorAll(`input[name=${radioName}]`).forEach((radio) => {
            if (radio.dataset.persistKey) {
              localStorage.setItem(
                radio.dataset.persistKey,
                radio === event.target ? "checked" : "unchecked"
              );
            }
          });
          break;
        default:
          console.warn(
            `input-persist: cannot persist unsupported element <input type=${event.target.type}>.`,
            event.target
          );
          break;
      }
    }
  }
);
        </script>
    </head>
    <body>
        <header>
            <div class="navbar">
                
                <img src="/img/logo-250px.jpg" alt="Seal-in-a-glass logo">
                <nav aria-labelledby="navbar-label">
                    <span id="navbar-label">You are here.</span>
                    <ol class="crumbs">
                        
<li>
    <a href="/">Home</a>
    <span aria-hidden="true">/</span>
</li>
<li>
    <a href="/blog/">Blog</a>
    <span aria-hidden="true">/</span>
</li>
<li>Post</li>

                    </ol>
                </nav>
                
            </div>
        </header>
        <main>
            
<style>
    h1 {
        margin-block-start: 0;
    }
</style>
<article>
    <h1>Slay the Spire #3: Introducing links</h1>
    <i>August 1, 2024</i>
    <p>So I've been thinking.</p>
<p>Last time, I said we were aiming to explore the branching paths a game of Slay the Spire can take. A key feature - maybe <em>the</em> key feature - would be to view the resulting state of an action's outcome. And I think that means selecting an outcome, then having that outcome's state displayed on the screen, with all of its actions and all of their outcomes. And then you should be able to view a <em>next</em> outcome a level deeper, and again, and you should be able to move back to a previous one you have viewed.</p>
<p>This app needs to let you <strong>navigate between states.</strong></p>
<p>That means links. With custom behavior. And messing with the browser history so back/forward buttons work as expected.</p>
<p>I mean, <em>maybe</em> we can avoid that? Maybe the links can have query strings defining the complete next state? But no, no, the page should show you the path from the initial state, dozens and dozens of actions deep, with links to jump back to them. We can't fit all of that data into a query string, because I'm pretty sure browsers won't guarantee what happens when URLs exceed 2048 characters. And there's all kinds of other persistent state we may want.</p>
<p>I think there's no way around it.</p>
<p>Boy, what a can of worms we have in store for us.</p>
<hr>
<p>Thankfully, to sketch out the HTML, we can leave that can of worms on the table, unopened. That's all implementation details, and we're not implementing anything yet.</p>
<p>So. Every outcome wants a link. Every link wants text that describes the page it leads to. The outcome headings are precisely that. Let's reuse them.</p>
<pre><code class="language-html">&lt;h3&gt;&lt;a href=&quot;&quot;&gt;Play Bash on Jaw Worm&lt;/a&gt;&lt;/h3&gt;
</code></pre>
<p>Yeah, visually, that looks good to me. I'm unsure about the <code>href</code> value - I know that <code>href=&quot;#&quot;</code> is safe for links that shouldn't take you off the current page, but <code>href=&quot;&quot;</code> seems to have the same effect. Let me look up what the difference is.</p>
<p>Huh. Hard to test on my phone, but some people say that <code>href=&quot;&quot;</code> actually reloads the page, while <code>href=&quot;#&quot;</code> jumps to the top of the page? The latter seems like less trouble. If it's the wrong approach, it should be easy to fix later.</p>
<pre><code class="language-html">&lt;h3&gt;&lt;a href=&quot;#&quot;&gt;Play Bash on Jaw Worm&lt;/a&gt;&lt;/h3&gt;
</code></pre>
<p>Now for Strike:</p>
<pre><code class="language-html">&lt;h3&gt;&lt;a href=&quot;#&quot;&gt;Play Strike on Jaw Worm&lt;/a&gt;&lt;/h3&gt;
</code></pre>
<p>And Defend:</p>
<pre><code class="language-html">&lt;h3&gt;&lt;a href=&quot;#&quot;&gt;Play Defend&lt;/a&gt;&lt;/h3&gt;
</code></pre>
<p>And end turn... uh oh:</p>
<pre><code class="language-html">&lt;h3&gt;End turn&lt;/h3&gt;
&lt;ul&gt;
    &lt;li&gt;Player: -11 HP&lt;/li&gt;
    &lt;li&gt;Hand: -1 Bash, -2 Defend, +3 Strike&lt;/li&gt;
    &lt;li&gt;Draw pile: -4 Strike, -1 Defend&lt;/li&gt;
    &lt;li&gt;Discard pile: +1 Bash, +3 Defend, +1 Strike&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;60%&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
    &lt;li&gt;Jaw Worm: next move Bellow (gain 3 Strength and 6 Block)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;40%&lt;/a&gt;&lt;/h4&gt;
&lt;ul&gt;
    &lt;li&gt;Jaw Worm: next move Thrash (deal 7 damage, gain 5 Block)&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>I mean. It <em>works</em>. But &quot;60%&quot; and &quot;40%&quot; seem like terrible link texts, especially when we get more outcomes on the page with the same probabilities. I want link texts, taken out of context of where they are on the page, to give a decent idea of what they lead to, and to be unique.</p>
<p>Maybe if we expand the headings, swallow the cost of duplicating some text, it would be better.</p>
<pre><code class="language-html">&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn (60%)&lt;/a&gt;&lt;/h4&gt;
&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn (40%)&lt;/a&gt;&lt;/h4&gt;
</code></pre>
<p>Yeah. Better. And actually makes the page more readable to me. Still, the links won't be unique in the cases where they have the same probability.</p>
<p>Could we, uh, number them?</p>
<pre><code class="language-html">&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn 1 (60%)&lt;/a&gt;&lt;/h4&gt;
&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn 2 (40%)&lt;/a&gt;&lt;/h4&gt;
</code></pre>
<p>Looks... kind of weird, but I don't have a better idea for making them unique. Now we have two unexplained numbers right next to each other. It reads confusing to me, the meaning of the percentage looks <em>more</em> ambiguous now.</p>
<p>Would adding more text help us, again?</p>
<pre><code class="language-html">&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn 1 (60% chance)&lt;/a&gt;&lt;/h4&gt;
&lt;h4&gt;&lt;a href=&quot;#&quot;&gt;End turn 2 (40% chance)&lt;/a&gt;&lt;/h4&gt;
</code></pre>
<p>It's all subjective, so I don't know if other people finds this clearer, but this is my favorite so far. I'm happy to proceed with this.</p>
<p>Nice! The headings look better, and we now have links that promise us that we can explore all the ways the game can go. I like the look of this!</p>
<p>We actually have enough HTML sketched up now that we could stop it here and start working on implementing the logic, making this skeleton come alive. I think that's the right thing to do. Sketching up more features at this point would help surface design issues we will run into, but I trust our ability to solve them later better than our ability to prepare for them now.</p>
<hr>
<p>A lovely thing about these blog posts, these dev logs, is that it forces me to put each and every little thing I do into words. It forces me to justify my decisions. As a result, my development so far has been more deliberative, more steady and well-reasoned, than anything I can remember developing in private. I am very happy with every little step we've made along the way, even if - or maybe <em>because</em> - it's very small pieces of work, all in all.</p>
<p>These posts also crystallize my train of thought in a way where it's easy for me to pick up where I left off. If - sorry, <em>when</em> - I stop working on this project for a while, I have enough context made permanent on these pages that I should be able to pick it up exactly where I left off, even if it has been years.</p>
<p>I wonder if I'll have to put that theory to the test someday. Oh well.</p>
<p>Next time, let's write some JavaScript. Let's make things <em>change</em>.</p>
<hr>
<p><em><a href="https://codeberg.org/cvennevik/crystal-spire/src/commit/12d6098e07ecd5de448b3d76e96805c9496145bb/index.html">Last commit: &quot;#3: Introducing links&quot;</a></em></p>

</article>

        </main>
    </body>
</html>